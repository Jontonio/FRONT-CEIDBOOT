<div class="main">
  <p-card>
    <div class="grid content">
      <div class="col table-responsive">
        <p-table [value]="listUsuarios" responsiveLayout="scroll">
          <ng-template pTemplate="header">
              <tr>
                  <th>ID</th>
                  <th>Avatar</th>
                  <th pSortableColumn="Nombres">Nombres <p-sortIcon field="Nombres"></p-sortIcon></th>
                  <th pSortableColumn="Email">Email <p-sortIcon field="Email"></p-sortIcon></th>
                  <th>Celular</th>
                  <th>Último acceso</th>
                  <th>Rol</th>
                  <th>Acceso</th>
                  <th>Operación</th>
              </tr>
          </ng-template>
          <ng-template pTemplate="body" let-usuario let-rowIndex="rowIndex">
              <tr>
                  <td>{{startPage + (rowIndex+1)}}</td>
                  <td>
                    <div class="content-avatar">
                      <p-avatar [label]="usuario.Nombres | avatarName"
                                [style]="{'background-color': '#9c27b0', 'color': '#ffffff'}"
                                shape="circle"></p-avatar>
                    </div>
                  </td>
                  <td>{{ usuario.Nombres | titlecase }} {{ usuario.ApellidoPaterno | titlecase }}</td>
                  <td>{{ usuario.Email | titlecase }}</td>
                  <td>{{usuario.CodePhone}} {{ usuario.Celular}}</td>
                  <td>
                    <div *ngIf="usuario.FechaAcceso else Acess">
                      <p-tag styleClass="mr-2" severity="success" [value]="usuario.FechaAcceso | date:'MMM d, h:mm a' | fechAcceso" [rounded]="true"></p-tag>
                    </div>
                    <ng-template #Acess>
                      <p-tag styleClass="mr-2" severity="danger" [value]="usuario.FechaAcceso | fechAcceso" [rounded]="true"></p-tag>
                    </ng-template>
                  </td>
                  <td>
                    <p-tag styleClass="mr-2"
                           severity="info"
                           [value]="usuario.rol.TipoRol" [rounded]="true"></p-tag>
                  </td>
                  <td>
                    <button pButton
                            pRipple
                            type="button"
                            *ngIf="usuario.Habilitado else disable"
                            [disabled]="imAuth?.Id==usuario.Id?true:false"
                            (click)="Inhabilitar(usuario, usuario.Habilitado)"
                            label="habilitado"
                            class="p-button-outlined p-button-rounded"></button>
                    <ng-template #disable>
                      <button pButton
                              pRipple
                              type="button"
                              label="Inhabilitado"
                              (click)="Inhabilitar(usuario, usuario.Habilitado)"
                              class="p-button-outlined p-button-rounded p-button-danger"></button>
                    </ng-template>
                  <td>
                    <button pButton
                            pRipple
                            type="button"
                            (click)="confirmDelete(usuario)"
                            [disabled]="imAuth?.Id==usuario.Id?true:false"
                            class="p-button-danger p-button-text">
                            <i class="fa-solid fa-trash-can mr-1"></i> Eliminar</button>
                    <button pButton
                            pRipple
                            type="button"
                            (click)="sendEditUserio(usuario.Id)"
                            class="p-button-text p-button-plain">
                            <i class="fa-regular fa-pen-to-square mr-1"></i> Editar</button>
                  </td>
              </tr>
          </ng-template>
        </p-table>
        <div class="mt-4" *ngIf="resUsuarios">
          <p-paginator [rows]="5"
                       [totalRecords]="resUsuarios.count"
                       [rowsPerPageOptions]="[5,10,15,20]"
                       (onPageChange)="paginate($event)"></p-paginator>
        </div>
        <app-loadding *ngIf="loadding && !changePage && _usuario.listUsuarios.length==0" msg="Lista de usuarios"></app-loadding>
        <app-lista-vacia *ngIf="listUsuarios.length==0 && !loadding" msg="No se encontraron usuarios registrados"></app-lista-vacia>
      </div>
    </div>
  </p-card>
</div>

<!-- Delete message dialog -->
<p-confirmDialog [style]="{width: '50vw'}"
                 key="deleteDialog"
                 [position]="position"
                 [baseZIndex]="10000"
                 acceptLabel="Confirmar"
                 [breakpoints]="{'960px': '75vw', '640px': '100vw'}"
                 rejectButtonStyleClass="p-button-outlined"></p-confirmDialog>

<!-- Disable and enable dialog  -->
<p-confirmDialog [style]="{width: '50vw'}"
                 key="enableDialog"
                 [position]="position"
                 [baseZIndex]="10000"
                 acceptLabel="Confirmar"
                 [breakpoints]="{'960px': '75vw', '640px': '100vw'}"
                 rejectButtonStyleClass="p-button-outlined"></p-confirmDialog>

<!-- A component that is used to show messages to the user. -->
<p-toast position="top-right" [breakpoints]="{'920px': {width: '100%', right: '0', left: '0', padding:'10px'}}"></p-toast>
