<div class="header-conatiner-pagos"></div>
<div class="container-pagos animate__animated animate__fadeIn mb-5">
  <div class="content-form-pagos">
    <div class="mb-2">
      <p-card header="Nota">
        <p><i class="fa-solid fa-message"></i> Para subir su voucher de pago es necesario consultar sus datos en el siguiente formulario.</p>
      </p-card>
    </div>
    <div>
      <div class="progressBar">
        <p-progressBar *ngIf="loading" mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
      </div>
      <p-card header="Formulario de consulta">
        <p-messages key="message-pagos"></p-messages>
        <!-- <p-toast key="message-pagos"
                 [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"
                 [baseZIndex]="999999"></p-toast> -->
        <mat-vertical-stepper [linear]="true" #stepper >
          <mat-step [stepControl]="formBusqueda">
            <form [formGroup]="formBusqueda">
              <ng-template matStepLabel>Consultar datos</ng-template>
              <div class="field">
                <label for="usuario" class="block mb-2">Tipo documento</label>
                <p-dropdown class="p-fluid p-grid p-formgrid"
                            [options]="card"
                            formControlName="TipoDocumento"
                            (ngModelChange)="changeCard($event)"
                            optionValue="code"
                            optionLabel="name">
                        </p-dropdown>
                <small *ngIf="TipoDocumento.hasError('required') && TipoDocumento.dirty"
                      class="p-error">El tipo de documento es <strong>requerido</strong></small>
              </div>
              <div class="field">
                <label for="Documento" class="block">{{TipoDocumentoSelected}}</label>
                <input id="Documento"
                       type="text"
                       formControlName="Documento"
                       [maxLength]="TipoDocumentoSelected=='DNI'?8:15"
                       minlength="8"
                       [placeholder]="'Digite su '+TipoDocumentoSelected"
                       pInputText/>
                <small *ngIf="Documento.hasError('pattern') && !Documento.hasError('required')"
                       class="p-error">Digite un número de {{TipoDocumentoSelected}} <strong>válido</strong></small>
                <small *ngIf="Documento.hasError('required') && Documento.dirty"
                       class="p-error">El {{TipoDocumentoSelected}} es <strong>requerido</strong></small>
              </div>
              <div>
                <button mat-raised-button (click)="search()" [disabled]="loading">{{loading?'Consultando':'Consultar'}}</button>
              </div>
            </form>
          </mat-step>
          <mat-step [stepControl]="formSelectGrupo">
            <form [formGroup]="formSelectGrupo">
              <ng-template matStepLabel>Mis cursos</ng-template>
              <p class="mb-3 mt-2">Usted esta matriculado en los siguientes cursos de idiomas. <b>Selecione el curso para subir el voucher</b></p>
                <div *ngIf="estudianteEnGrupo">
                  <div class="field-radiobutton content-items"
                       *ngFor="let item of estudianteEnGrupo, let i=index">
                      <p-radioButton name="EnGrupo"
                                     [value]="item"
                                     formControlName="EnGrupo"
                                     [inputId]="i+''"></p-radioButton>
                      <label class="flex justify-content-center align-items-center label-item" [for]="i">
                        <img class="img-flag" [src]="item.grupo.curso.UrlBandera" alt="">
                        <b>
                          <p class="ml-2">{{item.grupo.curso.NombreCurso | titlecase}} {{item.grupo.curso.nivel.Nivel | lowercase}}</p>
                        </b>
                      </label>
                  </div>
                  <div class="mb-3">
                    <small *ngIf="EnGrupo.hasError('required') && EnGrupo.dirty"
                         class="p-error">Selecione el curso para continuar*</small>
                  </div>
                </div>
                <div>
                  <button mat-raised-button matStepperPrevious class="mr-2">Regresar</button>
                  <button mat-raised-button (click)="validSelectCurso()">Siguiente</button>
                </div>
            </form>
          </mat-step>
          <mat-step [stepControl]="formCategoriaPago">
            <form [formGroup]="formCategoriaPago">
              <ng-template matStepLabel>Tipo de pago</ng-template>
              <p class="mb-3 mt-2">Selecione el tipo de pago que va a realizar</p>
                <div>
                  <div class="field-radiobutton content-items"
                       *ngFor="let categoria of listCategoriaPago, let indice=index">
                      <p-radioButton name="categoriaPago"
                                     [value]="categoria"
                                     formControlName="categoriaPago"
                                     [inputId]="indice+''"></p-radioButton>
                      <label class="flex justify-content-center align-items-center label-item"
                             [for]="indice"><b><p class="ml-2">{{categoria.TipoCategoriaPago | titlecase}}</p></b>
                      </label>
                  </div>
                  <div class="mb-3">
                    <small *ngIf="categoriaPago.hasError('required') && categoriaPago.dirty"
                         class="p-error">Selecione una categoría de pago para continuar*</small>
                  </div>
                </div>
                <div>
                  <button mat-raised-button matStepperPrevious class="mr-2">Regresar</button>
                  <button mat-raised-button (click)="validSelectCategoria()">Siguiente</button>
                </div>
            </form>
          </mat-step>
          <mat-step [stepControl]="formFile">
            <ng-template matStepLabel>Subir vocuher</ng-template>
            <p class="mb-3 mt-2">Complete el siguiente formulario para registrar su pago</p>
            <form [formGroup]="formFile">
              <div class="grid">
                <div class="col">
                  <label for="MontoPago" class="block mb-2">Monto de pago S/.</label>
                  <p-inputNumber inputId="minmaxfraction"
                                  mode="decimal"
                                  class="p-fluid p-grid p-formgrid full-width"
                                  formControlName="MontoPago"
                                  [min]="0"
                                  [max]="1000"
                                  [minFractionDigits]="2"
                                  [maxFractionDigits]="5"></p-inputNumber>
                  <small *ngIf="MontoPago.hasError('pattern') && !MontoPago.hasError('required')"
                          class="p-error">Digite un monto de pago <strong>válido</strong></small>
                  <small *ngIf="MontoPago.hasError('required') && MontoPago.dirty"
                          class="p-error">El campo monto de pago es <strong>requerido</strong></small>
                </div>
                <div class="col-12 md:col-12">
                  <div class="">
                    <label for="NumOperacionLibro" class="block mb-2">Número de operación</label>
                    <input id="NumOperacionLibro"
                          class="p-fluid p-grid p-formgrid full-width"
                          type="text"
                          placeholder="Digite el número de operación"
                          maxlength="20"
                          formControlName="NumOperacion"
                          autocomplete="off"
                          pInputText/>
                    <small *ngIf="NumOperacion.hasError('pattern') && !NumOperacion.hasError('required')"
                    class="p-error">Digite un número de operación <strong>válido</strong></small>
                    <small *ngIf="NumOperacion.hasError('required') && NumOperacion.dirty"
                            class="p-error">El campo número de operación es <strong>requerido</strong></small>
                  </div>
                </div>
                <div class="col-12 md:col-12">
                  <div class="">
                    <label for="FechaPagoLibro" class="block mb-2">Fecha de pago</label>
                    <p-inputMask mask="99/99/9999"
                                 formControlName="FechaPago"
                                 placeholder="DD/MM/AAAA"></p-inputMask>
                    <small *ngIf="FechaPago.hasError('pattern') && !FechaPago.hasError('required')"
                            class="p-error">Digite una fecha de pago <strong>válida</strong></small>
                    <small *ngIf="FechaPago.hasError('required') && FechaPago.dirty"
                            class="p-error">El campo fecha de pago es <strong>requerido</strong></small>
                  </div>
                </div>
                <div class="col-12 md:col-12">
                  <div class="flex justify-content-between justify-content-center align-items-center content-file">
                    <label class="block label-file">Voucher de pago</label>
                    <div class="flex flex-column">
                      <button mat-raised-button
                              [disabled]="loadingFilePago"
                              (click)="uploadFile.click()"
                              class="custom-btn-file">
                              <mat-icon>{{(FileURL.value && !loadingFilePago)?'check':'attach_file'}}</mat-icon> Elija el archivo</button>
                      <input #uploadFile
                              (change)="selectFile($event)"
                              formControlName="FileURL"
                              type='file' style="display:none"/>
                      <small *ngIf="FileURL.hasError('required') && FileURL.dirty"
                              class="p-error">El voucher del pago es <strong>requerido</strong></small>
                    </div>
                  </div>
                </div>
              </div>
            </form>
            <div class="mt-3">
              <button mat-raised-button
                      class="button-custom"
                      (click)="save()"
                      [disabled]="loading">
                <i [ngClass]="{'pi-spin pi-spinner': loading,
                               'pi-save':!loading}" class="pi mr-1"></i> Registrar
              </button>
            </div>
          </mat-step>
        </mat-vertical-stepper>
      </p-card>
    </div>
  </div>
</div>

